# AOP 소개 - 애스펙트

#### 3. 런타임 시점

<img width="648" alt="image-20220711221245715" src="https://user-images.githubusercontent.com/58017318/178516363-dcb8520d-fc83-4a82-aba0-a49d430520e7.png">

런타임 시점은 컴파일도 다 끝나고, 클래스 로더에 클래스도 다 올라가서 이미 자바가 실행되고 난 다음을 말한다. <br>**자바의 메인( `main` ) 메서드가 이미 실행된 다음**이다. <br>따라서 자바 언어가 제공하는 범위 안에서 부가 기능을 적용해야 한다. **스프링과 같은 컨테이너**의 도움을 받고 **프록시와 DI, 빈 포스트** 프로세서 같은 개념들을 총 동원해야 한다. <br>이렇게 하면 최종적으로 프록시를 통해 스프링 빈에 부가 기능을 적용할 수 있다. 그렇다. 지금까지 우리가 학습한 것이 바로 프록시 방식의 AOP이다.

프록시를 사용하기 때문에 AOP 기능에 일부 제약이 있다. 하지만 특별한 컴파일러나, 자바를 실행할 때 복잡한 옵션과 클래스 로더 조작기를 설정하지 않아도 된다. 스프링만 있으면 얼마든지 AOP를 적용할 수 있다.

**부가 기능이 적용되는 차이를 정리하면 다음과 같다**.

- **컴파일 시점**: 실제 대상 코드에 애스팩트를 통한 부가 기능 호출 코드가 포함된다. AspectJ를 직접 사용해야 한다.
- **클래스 로딩 시점**: 실제 대상 코드에 애스팩트를 통한 부가 기능 호출 코드가 포함된다. AspectJ를 직접 사용해야 한다.
- **런타임 시점**: 위 두가지는 바이트코드를 직접 뜯어 수정하여 적용하는것이지만, <br>런타임 시점은 **실제 대상 코드는 그대로 유지**된다. 대신에 **프록시**를 통해 **부가 기능이 적용**된다. <br>따라서 항상 프록시를 통해야 부가 기능을 사용할 수 있다. 스프링 AOP는 이 방식을 사용한다.



### 결론

**스프링이 제공하는 AOP**는 **프록시를 사용**한다. <br>따라서 **프록시를 통해 메서드를 실행**하는 시점에만 **AOP가 적용**된다. <br>AspectJ를 사용하면 앞서 설명한 것 처럼 더 복잡하고 더 다양한 기능을 사용할 수 있다. <br>그렇다면 스프링 AOP 보다는 더 기능이 많은 AspectJ를 직접 사용해서 AOP를 적용하는 것이 더 좋지 않을까? <br><br>AspectJ를 사용하려면 공부할 내용도 많고, 자바 관련 설정(특별한 컴파일러, AspectJ 전용 문법, 자바 실행 옵션)도 복잡하다.<br> 반면에 **스프링 AOP**는 별도의 **추가 자바 설정 없이 스프링만 있으면 편리하게 AOP를 사용**할 수 있다. <br>실무에서는 스프링이 제공하는 AOP 기능만 사용해도 대부문의 문제를 해결할 수 있다. <br>따라서 스프링 AOP가 제공하는 기능을 학습하는 것에 집중하자.

-----

# AOP 용어 정리

<img width="647" alt="image-20220711230358588" src="https://user-images.githubusercontent.com/58017318/178516487-8245c3d1-ab89-4156-9f98-bf4b4f39641e.png">
<img width="647" alt="image-20220711230427768" src="https://user-images.githubusercontent.com/58017318/178516508-3f613f63-29c0-4ddd-b51f-081b15c70c68.png">

- **조인 포인트(Join point)**
  - 어드바이스가 적용될 수 있는 위치, 메소드 실행, 생성자 호출, 필드 값 접근, static 메서드 접근 같은 프로그램 실행 중 지점
  - 조인 포인트는 추상적인 개념이다. AOP를 적용할 수 있는 모든 지점이라 생각하면 된다.
  - 스프링 AOP는 프록시 방식을 사용하므로 조인 포인트는 항상 메소드 실행 지점으로 제한된다.
- **포인트컷(Pointcut)**
  - 조인 포인트 중에서 어드바이스가 적용될 위치를 선별하는 기능
  - 주로 AspectJ 표현식을 사용해서 지정
  - 프록시를 사용하는 스프링 AOP는 메서드 실행 지점만 포인트컷으로 선별 가능
- **타켓(Target)**
  - 어드바이스를 받는 객체, 포인트컷으로 결정
- **어드바이스(Advice)**
  - 부가 기능
  - 특정 조인 포인트에서 Aspect에 의해 취해지는 조치
  - Around(주변), Before(전), After(후)와 같은 다양한 종류의 어드바이스가 있음
- **애스펙트(Aspect)**
  - 어드바이스 + 포인트컷을 모듈화 한 것 
  - @Aspect 를 생각하면 됨
  - 여러 어드바이스와 포인트 컷이 함께 존재
- **어드바이저(Advisor)**
  - 하나의 어드바이스와 하나의 포인트 컷으로 구성 스프링 AOP에서만 사용되는 특별한 용어
- **위빙(Weaving)**
- 포인트컷으로 결정한 타켓의 조인 포인트에 어드바이스를 적용하는 것 
- 위빙을 통해 핵심 기능 코드에 영향을 주지 않고 부가 기능을 추가 할 수 있음 
- AOP 적용을 위해 애스펙트를 객체에 연결한 상태
  - 컴파일 타임(AspectJ compiler)
  - 로드 타임
  - 런타임, 스프링 AOP는 런타임, 프록시 방식
- **AOP 프록시**
  - AOP 기능을 구현하기 위해 만든 프록시 객체, 스프링에서 AOP 프록시는 JDK 동적 프록시 또는 CGLIB 프록시이다.
